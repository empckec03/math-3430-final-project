---
title: "F1 Project"
author: "Hailey, Finn, Mia, Caeli"
date: "2025-11-18"
output: html_document
---
**Our project attempted to see if weather (track temperature and rain) had an affect on driver and constructor performance in Formula 1 during the 2023 season. We tidied up both the weather and results datasets and made various visualizations. We planned to make a bar graph of average points scored per race by each driver, a scatter plot of average track temperature vs. points scored by each constructor each race but we decided to facet it as well to see trends easier, a faceted stacked bar graph of points scored each race colored by driver and faceted by constructor, and a stacked bar graph of total points scored by each driver with it colored by which points were scored in a rain race vs non rain race. We were successful in making these visualizations and we learned that Max Verstappen was the most consistent driver, regardless of weather conditions, and Red Bull was the most consistent constructor in all weather conditions. Performance of the cars in different track temperature does vary between constructors, with Red Bull doing well in all track temperatures. Performance of the cars may also vary due to upgrades added throughout the season. In teams like Red Bull, there is one driver scored the bulk of the team's points but in other teams, it was more equal. **
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**reading in the datasets**
```{r}
library(readxl)
library(tidyverse)
library(ggplot2)
library(dplyr)

results <- read_excel("Results.xlsx")

weather <- read_excel("Weather.xlsx")
```

**tidying up results to include only what we need and fix data types & names**
```{r}
results <- results %>%
  select(TeamName, FullName, Position, GridPosition, Status, Points, RoundNumber, EventName) %>%
  mutate(
    Position = as.integer(Position),
    GridPosition = as.integer(GridPosition),
    Points = as.integer(Points),
    RoundNumber = as.integer(RoundNumber)
  ) %>%
  rename (
    DriverName = FullName,
    Result = Position,
    QualiPosition = GridPosition
  )
results

```
**tidying up weather to include only the columns we need and fixing data types**
```{r}
weather <- weather %>%
  select(Rainfall, TrackTemp, RoundNumber, EventName) %>%
  mutate(RoundNumber = as.integer(RoundNumber)) %>%
  rename(Rain = Rainfall)
weather
```

**The below section breaks the weather dataframe into 2 parts: track temperature and rainy races. The average track temperature for each race & round number is found. The number of races that had more than 10 true's under rain was also found.**
```{r}
track_only <- weather %>%
  group_by(EventName, RoundNumber) %>%
  summarize(AvgTrackTemp = mean(TrackTemp, na.rm=T)) %>%
  arrange(desc(AvgTrackTemp))

track_only

rain_only <- weather %>%
  group_by(EventName, RoundNumber) %>%
  summarize(NumRain = sum(Rain)) %>%
  filter(NumRain >= 10)

rain_only
```
**This is a bar graph of the mean points scored per race for each driver, with the bars colored by constructor. It reveals that Max Verstappen has the highest mean number of points scored each race and Sergio Perez had the second highest amount. The plot reveals Verstappen and then Perez are the drivers that consistently score the most points and Red Bull Racing is the most consistent constructor when looking at the season as a whole. The drivers, Nyck De Vries and Logan Sargeant, and the constructors of AlphaTauri, Haas, and Alfa Romeo consistently score the least amount of points. **
```{r}
results %>%
  group_by(DriverName, TeamName) %>%
  summarize(mean_pts_scored = mean(Points, na.rm = T), .groups = "drop") %>%
  ggplot(aes(x = reorder(DriverName, mean_pts_scored), y = mean_pts_scored))+
  geom_bar(stat = "identity", aes(color = TeamName, fill = TeamName))+
  coord_flip() +
  labs(y = "Mean Points Scored Per Race", x = "Driver Name", color = "Team Name", fill = "Team Name")
```

**Scatterplot of average track temp vs. total points scored by constructor.**
```{r}
results %>%
  group_by(TeamName, EventName, RoundNumber) %>%
  summarize(race_points = sum(Points), .groups = "drop") %>%
  arrange(desc(race_points)) -> team_pts_by_race

team_track <- team_pts_by_race %>%
  left_join(track_only, by = c("EventName", "RoundNumber"))
team_track

ggplot(data = team_track, aes(x = AvgTrackTemp, y = race_points, color = TeamName)) +
  geom_point() +
  labs(
    x = "Average Track Temperature (Â°C)", 
    y = "Constructor Points (Per Race)",
    title = "Track Temperature vs Constructor Points"
  ) +
  facet_wrap(~TeamName, ncol = 5)
```
**Red Bull consistent (but with some outliers in higher temp). Mercedes, Ferrari all over the place. Hass, Alfa Romeo, Williams** **consistently bad (slightly better in the middle). Alpha Tauri, Mclaren better in higher temp. Aston Martin more consistent in** 
colder temps, scattered in higher temps. Alpine did well in colder temps, consistent in higher temps (except for outlier)**


```{r}
results %>%
  group_by(TeamName, EventName, RoundNumber, DriverName) %>%
  summarize(race_points = sum(Points), .groups = "drop") %>%
  arrange(desc(race_points)) -> pts_by_race

individual_track <- pts_by_race %>%
  left_join(track_only, by = c("EventName", "RoundNumber"))

individual_track

ggplot(data = individual_track, aes(x=race_points, fill=DriverName)) +
  geom_bar() +
  facet_wrap(~TeamName, ncol=5) +
  theme(legend.position = "none")
```

**The following is a bar graph detailing the total points scored by each driver for rainy vs dry races during the '23 season. In the case of the current dataset, there were only three rainy races, so there was a limited amount of data points to work with.**
```{r}
results_rain <- results %>%
  left_join(
    weather %>%
      group_by(EventName, RoundNumber) %>%
      summarize(
        NumRainRaces = sum(Rain, na.rm = T),
        RaceWeather = if_else(NumRainRaces > 0, "Rain", "No Rain"),
        .groups = "drop"
      ) %>%
      mutate(
        RaceWeather = factor(RaceWeather, levels = c("No Rain", "Rain"))
      ),
    by = c("EventName", "RoundNumber")
  ) %>%
  group_by(DriverName, RaceWeather) %>%
  summarize(TotalPts = sum(Points, na.rm = T), .groups = "drop_last") %>%
  mutate(DriverTotalPts = sum(TotalPts, na.rm = T)) %>%
  ungroup() %>%
  ggplot(aes(
         x = reorder(DriverName, DriverTotalPts),
         y = TotalPts,
         fill = RaceWeather
       )) + 
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(
    x = "Driver",
    y = "Total Points Scored (2023 Season)",
    fill = "Race Weather",
    title = "Driver Points for Rain vs No Rain Races"
  ) +
  theme_minimal()

results_rain
```
**All drivers consistently scored higher when there was no rain during the race; however, some drivers performed well in rainy races as well (i.e., Pierre Gasly).**
**Max Verstappen held a large lead for total points regardless of weather conditions, while Sergio Perez did well during dry races and struggled more during rainy races.**
